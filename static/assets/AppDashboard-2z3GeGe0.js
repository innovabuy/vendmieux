import{u as z,a as W,j as e,T as A}from"./index-B7iMGN3F.js";import{d as $,b as S,L as D}from"./vendor-DlVRmtdY.js";import{u as w,B as E}from"./shared-DQLyKLqw.js";const k={accroche:"Accroche",decouverte:"Découverte",creation_enjeu:"Création d'enjeu",argumentation:"Argumentation",traitement_objections:"Objections",engagement:"Engagement"},m=Object.keys(k);function I(t){return t>=16?"A":t>=13?"B":t>=10?"C":t>=7?"D":"E"}function M(t,n){return{A:n.ok,B:n.bl,C:n.wr,D:n.ac,E:n.dn}[t]||n.mt}function L({score:t,size:n=120,c:r}){const i=I(t),s=M(i,r),x=Math.min(t/20,1),p=(n-12)/2,y=2*Math.PI*p,g=y*(1-x);return e.jsxs("div",{style:{position:"relative",width:n,height:n},children:[e.jsxs("svg",{width:n,height:n,style:{transform:"rotate(-90deg)"},children:[e.jsx("circle",{cx:n/2,cy:n/2,r:p,fill:"none",stroke:r.bd,strokeWidth:8}),e.jsx("circle",{cx:n/2,cy:n/2,r:p,fill:"none",stroke:s,strokeWidth:8,strokeDasharray:y,strokeDashoffset:g,strokeLinecap:"round",style:{transition:"stroke-dashoffset 1s ease"}})]}),e.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{style:{fontSize:n*.28,fontWeight:800,color:s},children:t.toFixed(1)}),e.jsx("span",{style:{fontSize:n*.12,color:r.mt},children:"/20"}),e.jsx("span",{style:{fontSize:n*.18,fontWeight:700,color:s,marginTop:2},children:i})]})]})}function R({current:t,previous:n,size:r=240,c:i}){const s=r/2,x=r/2,p=r/2-30,y=m.length,g=2*Math.PI/y,b=(a,c)=>{const d=-Math.PI/2+a*g,l=c/20*p;return[s+l*Math.cos(d),x+l*Math.sin(d)]},v=(a,c,d,l)=>{const h=m.map((u,o)=>b(o,a[u]||0).join(",")).join(" ");return e.jsx("polygon",{points:h,fill:c,stroke:d,strokeWidth:2,strokeDasharray:l||"none"})};return e.jsxs("svg",{width:r,height:r,viewBox:`0 0 ${r} ${r}`,children:[[.25,.5,.75,1].map(a=>e.jsx("polygon",{points:m.map((c,d)=>{const l=-Math.PI/2+d*g,h=a*p;return`${s+h*Math.cos(l)},${x+h*Math.sin(l)}`}).join(" "),fill:"none",stroke:i.bd,strokeWidth:.5},a)),m.map((a,c)=>{const[d,l]=b(c,20);return e.jsx("line",{x1:s,y1:x,x2:d,y2:l,stroke:i.bd,strokeWidth:.5},c)}),n&&v(n,"transparent",i.dm,"4,4"),v(t,`${i.ac}22`,i.ac),m.map((a,c)=>{const[d,l]=b(c,t[a]||0);return e.jsx("circle",{cx:d,cy:l,r:4,fill:i.ac},a)}),m.map((a,c)=>{const d=-Math.PI/2+c*g,l=p+20,h=s+l*Math.cos(d),u=x+l*Math.sin(d);return e.jsx("text",{x:h,y:u,textAnchor:"middle",dominantBaseline:"middle",fill:i.mt,fontSize:10,fontWeight:500,children:k[a]},a)})]})}function T({label:t,score:n,evolution:r,c:i}){const s=Math.min(n/20*100,100),x=n>=14?i.ok:n>=10?i.wr:i.dn;return e.jsxs("div",{style:{marginBottom:10},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[e.jsx("span",{style:{fontSize:12,fontWeight:500},children:t}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("span",{style:{fontSize:13,fontWeight:700},children:[n,"/20"]}),r!==0&&e.jsxs("span",{style:{fontSize:11,color:r>0?i.ok:i.dn,fontWeight:600},children:[r>0?"+":"",r]})]})]}),e.jsx("div",{style:{height:6,borderRadius:3,background:i.bgE},children:e.jsx("div",{style:{height:6,borderRadius:3,background:x,width:`${s}%`,transition:"width 0.8s ease"}})})]})}function q(){var u;const t=w(),{user:n,logout:r}=z(),i=$(),[s,x]=S.useState(null),[p,y]=S.useState(null),[g,b]=S.useState([]),[v,a]=S.useState(!0);if(S.useEffect(()=>{if(!n){i("/app/login");return}Promise.all([W("/api/dashboard/stats").then(o=>o.json()),W("/api/dashboard/radar").then(o=>o.json()),W("/api/dashboard/historique?limit=10").then(o=>o.json())]).then(([o,f,j])=>{x(o),y(f),b(j)}).catch(()=>{}).finally(()=>a(!1))},[n]),v)return e.jsx("div",{style:{minHeight:"100vh",background:t.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{color:t.mt},children:"Chargement..."})});if(!s)return null;const c=s.competence_prioritaire,d=k[c]||"",l=((u=s.competences[c])==null?void 0:u.moyenne)||0,h={background:t.bgC,border:`1px solid ${t.bd}`,borderRadius:14,padding:20};return e.jsxs("div",{style:{minHeight:"100vh",background:t.bg,color:t.tx},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"14px 24px",borderBottom:`1px solid ${t.bd}`,background:`${t.bg}E0`,backdropFilter:"blur(12px)",position:"sticky",top:0,zIndex:100},children:[e.jsxs(D,{to:"/",style:{display:"flex",alignItems:"center",gap:10,textDecoration:"none",color:t.tx},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:8,background:`linear-gradient(135deg,${t.ac},${t.acL})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:800,color:"#fff"},children:"V"}),e.jsxs("span",{style:{fontSize:16,fontWeight:600},children:["Vend",e.jsx("span",{style:{color:t.ac},children:"Mieux"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx(A,{}),e.jsxs("span",{style:{fontSize:13,color:t.mt},children:[n==null?void 0:n.prenom," ",n==null?void 0:n.nom]}),e.jsx("button",{onClick:()=>{r(),i("/app/login")},style:{padding:"6px 14px",borderRadius:8,border:`1px solid ${t.bd}`,background:t.bgE,color:t.tx,fontSize:12,cursor:"pointer"},children:"Déconnexion"})]})]}),e.jsxs("div",{style:{maxWidth:1e3,margin:"0 auto",padding:"32px 20px"},children:[e.jsx("h1",{style:{fontSize:22,fontWeight:700,margin:"0 0 4px"},children:"Dashboard"}),e.jsxs("p",{style:{fontSize:13,color:t.mt,margin:"0 0 28px"},children:["Bonjour ",n==null?void 0:n.prenom,", voici vos performances"]}),s.sessions_total===0?e.jsxs("div",{style:{...h,textAlign:"center",padding:48},children:[e.jsx("p",{style:{fontSize:16,fontWeight:600,margin:"0 0 8px"},children:"Aucune session pour l'instant"}),e.jsx("p",{style:{fontSize:13,color:t.mt,margin:"0 0 20px"},children:"Lancez votre premier appel pour voir vos statistiques ici."}),e.jsx(D,{to:"/",style:{padding:"10px 24px",borderRadius:10,background:`linear-gradient(135deg,${t.ac},${t.acL})`,color:"#fff",fontSize:14,fontWeight:600,textDecoration:"none"},children:"Commencer un appel"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"280px 1fr",gap:16,marginBottom:16},children:[e.jsxs("div",{style:{...h,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:16},children:[e.jsx("span",{style:{fontSize:10,fontWeight:700,letterSpacing:1,color:t.mt,textTransform:"uppercase"},children:"Score moyen"}),e.jsx(L,{score:s.score_moyen,c:t}),e.jsxs("div",{style:{display:"flex",gap:16,fontSize:12,color:t.mt},children:[e.jsxs("span",{children:[s.sessions_total," session",s.sessions_total>1?"s":""]}),e.jsxs("span",{children:["Meilleur : ",s.meilleur_score,"/20"]})]}),s.progression_30j!==0&&e.jsxs(E,{color:s.progression_30j>0?"ok":"danger",children:[s.progression_30j>0?"+":"",s.progression_30j," / 30j"]})]}),e.jsxs("div",{style:h,children:[e.jsx("span",{style:{fontSize:10,fontWeight:700,letterSpacing:1,color:t.mt,textTransform:"uppercase",marginBottom:8,display:"block"},children:"Compétences FORCE 3D"}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(R,{current:(p==null?void 0:p.current)||{},previous:(p==null?void 0:p.previous)||{},c:t})}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:20,marginTop:4,fontSize:11,color:t.mt},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("span",{style:{width:12,height:2,background:t.ac,display:"inline-block"}})," Actuel"]}),e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("span",{style:{width:12,height:2,background:t.dm,display:"inline-block",borderTop:"1px dashed"}})," Il y a 30j"]})]})]})]}),e.jsxs("div",{style:{...h,marginBottom:16},children:[e.jsx("span",{style:{fontSize:10,fontWeight:700,letterSpacing:1,color:t.mt,textTransform:"uppercase",marginBottom:12,display:"block"},children:"Détail compétences"}),m.map(o=>{var f,j;return e.jsx(T,{label:k[o],score:((f=s.competences[o])==null?void 0:f.moyenne)||0,evolution:((j=s.competences[o])==null?void 0:j.evolution)||0,c:t},o)})]}),c&&e.jsx("div",{style:{...h,marginBottom:16,background:t.acD,borderColor:t.ac},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:10,background:`${t.ac}33`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18},children:l<8?"!":l<12?"~":"+"}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:13,fontWeight:600},children:["Priorité : ",d]}),e.jsxs("div",{style:{fontSize:12,color:t.mt},children:["Score moyen : ",l,"/20 — Travaillez cette compétence en priorité."]})]})]})}),e.jsxs("div",{style:h,children:[e.jsx("span",{style:{fontSize:10,fontWeight:700,letterSpacing:1,color:t.mt,textTransform:"uppercase",marginBottom:12,display:"block"},children:"Dernières sessions"}),g.length===0?e.jsx("p",{style:{fontSize:13,color:t.mt},children:"Aucune session enregistrée"}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`1px solid ${t.bd}`},children:[e.jsx("th",{style:{textAlign:"left",padding:"8px 10px",color:t.mt,fontWeight:600,fontSize:11},children:"Date"}),e.jsx("th",{style:{textAlign:"left",padding:"8px 10px",color:t.mt,fontWeight:600,fontSize:11},children:"Scénario"}),e.jsx("th",{style:{textAlign:"center",padding:"8px 10px",color:t.mt,fontWeight:600,fontSize:11},children:"Difficulté"}),e.jsx("th",{style:{textAlign:"center",padding:"8px 10px",color:t.mt,fontWeight:600,fontSize:11},children:"Score"})]})}),e.jsx("tbody",{children:g.map(o=>{const f=o.created_at?new Date(o.created_at):null,j=f?f.toLocaleDateString("fr-FR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):"—",_=o.score_global||0,B=I(_);return e.jsxs("tr",{onClick:()=>i(`/app/session/${o.id}`),style:{borderBottom:`1px solid ${t.bd}`,cursor:"pointer"},onMouseEnter:C=>C.currentTarget.style.background=t.bgE,onMouseLeave:C=>C.currentTarget.style.background="transparent",children:[e.jsx("td",{style:{padding:"10px"},children:j}),e.jsx("td",{style:{padding:"10px"},children:o.scenario_id==="__default__"?"Olivier Bertrand":o.scenario_id}),e.jsx("td",{style:{padding:"10px",textAlign:"center"},children:"*".repeat(o.difficulty||2)}),e.jsxs("td",{style:{padding:"10px",textAlign:"center"},children:[e.jsxs("span",{style:{fontWeight:700,color:M(B,t)},children:[_,"/20"]}),e.jsx("span",{style:{marginLeft:6,fontSize:11,color:t.mt},children:B})]})]},o.id)})})]})})]})]})]})]})}export{q as default};
